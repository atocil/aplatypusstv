<!doctype html>

<head>
    <script src="javascript/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="https://streamtip.com/socket.io/socket.io.js" type="text/javascript"></script>
    <script>
        var client_id = '52560de7300496d32b00322d'; // Client id from the Account area
        var access_token = 'YTliMTg1MjZiNmNjNjZkY2EyMTA2NmYz'; // Access token from the Account area
        var socket = io.connect('https://streamtip.com', {
            query: 'client_id=' + encodeURIComponent(client_id) + '&access_token=' + encodeURIComponent(access_token)
        });

        socket.on('authenticated', function() {
            console.log('authenticated');
        });

        socket.on('error', function(err) {
            if (err === '401::Access Denied::') {
                console.log('authentication failed');
            }
        });

        socket.on('newTip', function(data) {
            donation();
            var amount = "";
            var username = "";
            console.log('donation');
        });

        function donation() {
            $.ajax({
                url: 'https://streamtip.com/api/tips?client_id=52560de7300496d32b00322d&access_token=YTliMTg1MjZiNmNjNjZkY2EyMTA2NmYz&limit=1',
                type: 'GET',
                dataType: 'jsonp',
                success: function(json) {
                    amount = json["tips"][0]["amount"];
                    username = json["tips"][0]["username"];
                    var username_text = document.getElementById('username_text');
                    processDonation();

                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("error getting donation!");
                }
            });
        }

        function testdon() {
            amount = $("#Amount").val();
            processDonation();
        }

        function processDonation() {
            console.log("new donation " + amount);
            if (amount == 2.10) {
                var webm = document.getElementById('210');
                webm.src = "210.webm";
                var vid = document.getElementById("210v")
                vid.play();

                $("#210v").fadeToggle(1000);
                setTimeout(function() {
                    $("#210v").fadeToggle(1000);
                }, 13000);
            } else if (amount == 4.20) {
                var webm = document.getElementById('420');
                webm.src = "420.webm";
                var vid = document.getElementById("420v")
                vid.play();

                $("#420v").fadeToggle(1000);
                setTimeout(function() {
                    $("#420v").fadeToggle(1000);
                }, 13000);
            } else if (amount == 8.40) {
                var webm = document.getElementById('840');
                webm.src = "840.webm";
                var vid = document.getElementById("840v")
                vid.play();

                $("#840v").fadeToggle(1000);
                setTimeout(function() {
                    $("#840v").fadeToggle(1000);
                }, 16000);
            } else if (amount == 6.66) {
                var webm = document.getElementById('666');
                webm.src = "666.webm";
                var vid = document.getElementById("666v")
                vid.play();

                $("#666v").fadeToggle(1000);;
                setTimeout(function() {
                    $("#666v").fadeToggle(1000);
                }, 22000);
            } else if (amount == 42.00) {
                var webm = document.getElementById('4200');
                webm.src = "4200.webm";
                var vid = document.getElementById("4200v")
                vid.play();

                $("#4200v").fadeToggle(1000);
                setTimeout(function() {
                    $("#4200v").fadeToggle(1000);
                }, 12000);
            } else if (amount == 100.00) {
                var webm = document.getElementById('10000');
                webm.src = "10000.webm";
                var vid = document.getElementById("10000v")
                vid.play();

                $("#10000v").fadeToggle(1000);
                setTimeout(function() {
                    $("10000v").fadeToggle(1000);
                }, 12000);
            } else {
                var vid = document.getElementById("defaultv")
                vid.play();

                $("#defaultv").fadeToggle(1000);
                setTimeout(function() {
                    $("#defaultv").fadeToggle(1000);
                }, 20000);
            }
        }
    </script>

    <title>Donation Page</title>

    <link href="stylesheets/donation.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <input id="Amount" />
    <input type="submit" onclick="testdon();" />

    <div id="test">
        <video id="210v" width="100%" Style="Display:none">
            <source id="210" src="videos/210.webm" type="video/webm" />
        </video>
        <video id="420v" width="100%" Style="Display:none">
            <source id="420" src="videos/420.webm" type="video/webm" />
        </video>
        <video id="666v" width="100%" Style="Display:none">
            <source id="666" src="videos/666.webm" type="video/webm" />
        </video>
        <video id="840v" width="100%" Style="Display:none">
            <source id="840" src="videos/840.webm" type="video/webm" />
        </video>
        <video id="4200v" width="100%" Style="Display:none">
            <source id="4200" src="videos/4200.webm" type="video/webm" />
        </video>
        <video id="8400v" width="100%" Style="Display:none">
            <source id="8400" src="videos/8400.webm" type="video/webm" />
        </video>
        <video id="10000v" width="100%" Style="Display:none">
            <source id="10000" src="videos/1000.webm" type="video/webm" />
        </video>
        <video id="U10v" width="100%" Style="Display:none">
            <source id="U10" src="videos/100.webm" type="video/webm" />
        </video>
        <video id="defaultv" width="100%" Style="Display:none">
            <source id="default" src="videos/default.webm" type="video/webm" />
        </video>

    </div>
</body>

</html>
